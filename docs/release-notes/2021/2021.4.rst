GROMACS 2021.4 release notes
----------------------------

This version was released on TODO, 2021. These release notes
document the changes that have taken place in GROMACS since the
previous 2021.3 version, to fix known issues. It also incorporates all
fixes made in version 2020.6 and earlier, which you can find described
in the :ref:`release-notes`.

.. Note to developers!
   Please use """"""" to underline the individual entries for fixed issues in the subfolders,
   otherwise the formatting on the webpage is messed up.
   Also, please use the syntax :issue:`number` to reference issues on GitLab, without the
   a space between the colon and number!

Fixes where mdrun could behave incorrectly
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Fixed crash for large system with virtual sites
"""""""""""""""""""""""""""""""""""""""""""""""

When large system with virtual sites were ran with domain decomposition
and OpenMP threading, mdrun would crash when the number of atoms in
a domain and its halo were more than 200000.

:issue:`4167`

Disabled the use of PME Mixed mode for FEP simulations
""""""""""""""""""""""""""""""""""""""""""""""""""""""

The use of Mixed mode PME (``-pme gpu -pmefft cpu``) led to incorrect
computation of :math:`{\frac{\partial V}{\partial {\lambda}}}` in FEP
simulations.

Mixed mode is only used when explicitly requested by the user.

:issue:`4190`


Fixes for ``gmx`` tools
^^^^^^^^^^^^^^^^^^^^^^^

grompp now prints a note again when combining center of mass motion removal and position restraints
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

:issue:`4128`

Static selections of large index groups now work
""""""""""""""""""""""""""""""""""""""""""""""""

Commands like ``gmx distance -f traj.xtc -n ndx.ndx -select "group
\"Contacts\""`` only worked if the size of ``Contacts`` was less than
the number of atoms. This restriction was a bug, and has been fixed so
that ``Contacts`` make take any size.

Other similar uses of static selections derived from index groups will
also now work.

:issue:`4148`

Fixes that affect portability
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Miscellaneous
^^^^^^^^^^^^^

